---
title: Ransackの検索結果をGoogle Analyticsで可視化する
date: "2021-04-23"
category: "dev"
---

Google Analytics の「サイト内検索」の機能で、Ransack の検索をトラッキングする方法似関してのメモです。

## 結論

- 管理 > ビューの設定 > 「サイト内検索のトラッキング」を ON にする
- クエリパラメータには `q[title_cont]` のように設定する

## 経緯

Google Analytics の「サイト内検索」をオンにすれば、サイト内でどういったキーワードで検索されたかを追うことができます。
検索結果の URL が `?q=hoge` のような場合には、クエリパラメータの設定では `q` とだけ設定しておくだけで設定は完了です。

しかし、Ransack を使った場合の検索では URL の末尾は `?utf8=%E2%9C%93&q%5Bfirst_name_or_last_name_cont%5D=Tanaka` のようにエンコードされたものになります。  
デモアプリ: [RansackDemo](http://ransack-demo.herokuapp.com/)

この場合に、クエリパラメータにどういった設定をすれば良いのかがわからず、情報もあまりなかったので記事にしました。

## クエリパラメータの設定手順

結論に書いた通り、クエリパラメータには `q[title_cont]`のように設定しておけばサイト内検索をトラッキングできます。
行動 > サイトコンテンツ > 全てのページで、どういったパスに対してリクエストがあったかを確認できます。このページを見ながら、Ransack の検索結果が GA 上でどう解釈されているのかを確認します。

Ransack の検索結果 URL は `/search?q[title_cont]=hoge` のようになっているので、`q[title_cont]`をクエリパラメータとして設定すれば検索をトラッキングができます。

ちなみに、クエリパラメータは最大 5 つまで設定が可能なので、検索の種類が多い場合も 5 つまでは対応できます。
